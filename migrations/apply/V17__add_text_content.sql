CREATE TABLE IF NOT EXISTS host (id uuid PRIMARY KEY, address TEXT NOT NULL, created_at TIMESTAMP NOT NULL);
CREATE TABLE IF NOT EXISTS star_text (id uuid PRIMARY KEY, star_id uuid NOT NULL, comment_id uuid NULL, text_index INT NOT NULL, created_at TIMESTAMP NOT NULL);
ALTER TABLE star_text ADD CONSTRAINT fk_star_text_star_id__id FOREIGN KEY (star_id) REFERENCES star(id) ON DELETE CASCADE ON UPDATE RESTRICT;
ALTER TABLE star_text ADD CONSTRAINT fk_star_text_comment_id__id FOREIGN KEY (comment_id) REFERENCES "comment"(id) ON DELETE SET NULL ON UPDATE RESTRICT;
ALTER TABLE star ALTER COLUMN identifier TYPE TEXT, ALTER COLUMN identifier DROP NOT NULL;
ALTER TABLE star ALTER COLUMN title TYPE TEXT, ALTER COLUMN title DROP NOT NULL;
ALTER TABLE star ALTER COLUMN link TYPE TEXT, ALTER COLUMN link DROP NOT NULL;
ALTER TABLE star ALTER COLUMN visibility TYPE REAL, ALTER COLUMN visibility DROP NOT NULL;
ALTER TABLE star ALTER COLUMN comment_count TYPE INT, ALTER COLUMN comment_count DROP NOT NULL;
ALTER TABLE star ALTER COLUMN vote_count TYPE INT, ALTER COLUMN vote_count DROP NOT NULL;
ALTER TABLE galaxy ADD host_id uuid NOT NULL;
ALTER TABLE galaxy ADD created_at TIMESTAMP NOT NULL;
ALTER TABLE galaxy ADD CONSTRAINT fk_galaxy_host_id__id FOREIGN KEY (host_id) REFERENCES host(id) ON DELETE CASCADE ON UPDATE RESTRICT;
